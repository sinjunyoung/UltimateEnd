<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="using:UltimateEnd.Models"
             xmlns:converters="using:UltimateEnd.Converters"
             xmlns:behaviors="using:UltimateEnd.Behaviors"
             x:Class="UltimateEnd.Views.Overlays.PlaylistManagementOverlay"
             x:Name="RootControl">

	<UserControl.Resources>
		<converters:BoolToHighlightBrushConverter x:Key="BoolToHighlightBrush"/>
	</UserControl.Resources>

	<Grid Name="MainGrid"
          IsVisible="False"
          Background="#80000000"
          ZIndex="3000"
          PointerPressed="OnBackgroundClick">

		<Border Name="MainBorder"
                Background="{DynamicResource Background.Card}"
                CornerRadius="12,0,0,12"
                Padding="10"
                HorizontalAlignment="Right"
                VerticalAlignment="Stretch"
                Width="{StaticResource Size.OverlayWidth}">

			<Grid RowDefinitions="Auto,*,Auto" VerticalAlignment="Stretch">

				<!-- Header -->
				<Border Grid.Row="0"
                        Background="{DynamicResource Background.Secondary}"
                        Padding="10"
                        BorderThickness="0,0,0,1"
                        BorderBrush="{DynamicResource Background.Border}">
					<Grid ColumnDefinitions="Auto,*,Auto">
						<Border Grid.Column="0"
                                ClipToBounds="False"
                                PointerPressed="OnClose"
                                Cursor="Hand"
                                Margin="0,0,15,0">
							<PathIcon Classes="AnimatedIcon"
                                      Data="{StaticResource Icon.Back}"
                                      Width="{StaticResource IconSize.MenuIcon}"
                                      Height="{StaticResource IconSize.MenuIcon}"
                                      VerticalAlignment="Center"/>
						</Border>
						<TextBlock Grid.Column="1"
                                   Text="플레이리스트 관리"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource Text.Primary}"
                                   VerticalAlignment="Center"/>
						<Border Grid.Column="2"
                                ClipToBounds="False"
                                PointerPressed="OnAddClick"
                                Cursor="Hand">
							<PathIcon Classes="AnimatedIcon"
                                      Data="{StaticResource Icon.Add}"
                                      Width="{StaticResource IconSize.MenuIcon}"
                                      Height="{StaticResource IconSize.MenuIcon}"
                                      Margin="10,0,10,0"
                                      VerticalAlignment="Center"/>
						</Border>
					</Grid>
				</Border>

				<!-- Content Area -->
				<ScrollViewer Grid.Row="1" Margin="0,2,0,2">
					<ItemsRepeater Name="PlaylistItemsControl">
						<ItemsRepeater.Layout>
							<StackLayout Spacing="0" />
						</ItemsRepeater.Layout>
						<ItemsRepeater.ItemTemplate>
							<DataTemplate DataType="models:PlaylistItem">
								<Border Padding="12,8"
										Margin="2"
										CornerRadius="8"
										Cursor="Hand"
										Background="{Binding IsSelected, Converter={StaticResource BoolToHighlightBrush}}"
										Tapped="OnPlaylistItemTapped">
									<Grid RowDefinitions="Auto,Auto" ColumnDefinitions="*,Auto,Auto">
										<!-- 플레이리스트 이름 -->
										<TextBlock Grid.Row="0" Grid.Column="0"
												   Text="{Binding Playlist.Name}"
												   FontSize="16"
												   FontWeight="SemiBold"
												   Foreground="{DynamicResource Text.Primary}"
												   VerticalAlignment="Center"/>
										<!-- 게임 개수 -->
										<TextBlock Grid.Row="1" Grid.Column="0"
												   FontSize="13"
												   Foreground="{DynamicResource Foreground.Tertiary}"
												   Margin="0,4,0,0">
											<Run Text="{Binding Playlist.GameCount}"/>
											<Run Text="개 게임"/>
										</TextBlock>
										<!-- 편집 버튼 (선택된 항목만 표시) -->
										<Button Grid.Row="0" Grid.Column="1" Grid.RowSpan="2"
												Content="수정"
												Click="OnEditButtonClick"
												Background="{DynamicResource Accent.Blue}"
												Foreground="{DynamicResource Button.Foreground}"
												Margin="2,2,2,2"
												VerticalAlignment="Center"
												IsVisible="{Binding IsSelected}"/>
										<!-- 삭제 버튼 (선택된 항목만 표시) -->
										<Button Grid.Row="0" Grid.Column="2" Grid.RowSpan="2"
												Content="삭제"
												Click="OnDeleteButtonClick"
												Background="{DynamicResource Background.Hover}"
												Foreground="{DynamicResource Text.Primary}"
												Margin="2,2,2,2"
												VerticalAlignment="Center"
												IsVisible="{Binding IsSelected}"/>
									</Grid>
								</Border>
							</DataTemplate>
						</ItemsRepeater.ItemTemplate>
					</ItemsRepeater>
				</ScrollViewer>

				<!-- Info Text (when no playlists) -->
				<TextBlock Grid.Row="1"
                           Name="EmptyStateText"
                           Text="플레이리스트가 없습니다.&#x0a;+ 버튼을 눌러 새 플레이리스트를 만드세요."
                           FontSize="15"
                           Foreground="{DynamicResource Text.Muted}"
                           TextAlignment="Center"
                           VerticalAlignment="Center"
                           HorizontalAlignment="Center"
                           IsVisible="False"/>

				<!-- Action Buttons -->
				<Border Grid.Row="2"
                        Background="{DynamicResource Background.Secondary}"
                        Padding="15,10"
                        BorderThickness="0,1,0,0"
                        BorderBrush="{DynamicResource Background.Border}">
					<Button Content="닫기"
                            Focusable="False"
                            Click="OnCloseClicked"
                            Padding="25,10"
                            Background="{DynamicResource Background.Hover}"
                            Foreground="{DynamicResource Text.Primary}"
                            BorderThickness="0"
                            CornerRadius="6"
                            Cursor="Hand"
                            HorizontalAlignment="Right"/>
				</Border>
			</Grid>
		</Border>

		<!-- Create/Edit Overlay -->
		<Grid Name="EditOverlay"
              IsVisible="False"
              Background="#CC000000"
              ZIndex="3100"
              PointerPressed="OnEditOverlayBackgroundClick">
			<Border Background="{DynamicResource Background.Card}"
                    CornerRadius="10"
                    Padding="20"
                    Margin="20,5,20,20"
                    MaxWidth="400"
                    VerticalAlignment="Top">
				<StackPanel Spacing="15">
					<Grid ColumnDefinitions="*,Auto">
						<TextBlock Grid.Column="0"
                                   Name="EditOverlayTitle"
                                   Text="플레이리스트 만들기"
                                   FontSize="18"
                                   FontWeight="Bold"
                                   Foreground="{DynamicResource Text.Primary}"/>
						<Border Grid.Column="1"
                                PointerPressed="OnEditOverlayClose"
                                Cursor="Hand">
							<TextBlock Text="✕"
                                       FontSize="20"
                                       Foreground="{DynamicResource Text.Muted}"/>
						</Border>
					</Grid>

					<StackPanel Spacing="10">
						<TextBlock Text="이름"
                                   FontSize="14"
                                   Foreground="{DynamicResource Text.Primary}"/>
						<TextBox Name="NameTextBox"
                                 Watermark="플레이리스트 이름"
                                 MaxLength="50"
                                 Padding="12"
                                 FontSize="15"
                                 Background="{DynamicResource TextBox.Background}"
                                 Foreground="{DynamicResource TextBox.Foreground}"
                                 BorderBrush="{DynamicResource TextBox.BorderBrush}"
                                 CaretBrush="{DynamicResource TextBox.CaretBrush}"
                                 SelectionBrush="{DynamicResource TextBox.SelectionBrush}"
                                 SelectionForegroundBrush="{DynamicResource TextBox.SelectionForegroundBrush}">
							<Interaction.Behaviors>
								<behaviors:TextBoxColorFixBehavior/>
							</Interaction.Behaviors>
						</TextBox>
					</StackPanel>

					<!-- 커버 이미지 선택 추가 -->
					<StackPanel Spacing="10">
						<TextBlock Text="커버 이미지 (선택)"
								   FontSize="14"
								   Foreground="{DynamicResource Text.Primary}"/>
						<Grid ColumnDefinitions="*,Auto">
							<Border Grid.Column="0"
									Name="CoverImagePreview"
									Height="120"
									CornerRadius="8"
									ClipToBounds="True"
									Background="{DynamicResource Background.Secondary}">
								<Image Name="CoverImageDisplay"
									   Stretch="Uniform"/>
							</Border>
							<StackPanel Grid.Column="1"
										Spacing="5"
										Margin="10,0,0,0"
										VerticalAlignment="Center">
								<Button Content="선택"
										Click="OnSelectCoverImage"
										Padding="15,8"
										Background="{DynamicResource Accent.Blue}"
										Foreground="{DynamicResource Button.Foreground}"
										BorderThickness="0"
										CornerRadius="6"
										Cursor="Hand"/>
								<Button Content="제거"
										Click="OnRemoveCoverImage"
										Padding="15,8"
										Background="{DynamicResource Background.Hover}"
										Foreground="{DynamicResource Text.Primary}"
										BorderThickness="0"
										CornerRadius="6"
										Cursor="Hand"/>
							</StackPanel>
						</Grid>
					</StackPanel>

					<TextBlock Name="EditStatusText"
                               Text=" "
                               FontSize="13"
                               Foreground="{DynamicResource Text.Muted}"
                               TextWrapping="Wrap"/>

					<Grid ColumnDefinitions="*,10,*">
						<Button Grid.Column="0"
                                Content="취소"
                                Focusable="False"
                                behaviors:SoundBehavior.ClickSound="Cancel"
                                Click="OnEditCancel"
                                Padding="15,10"
                                Background="{DynamicResource Background.Hover}"
                                Foreground="{DynamicResource Text.Primary}"
                                BorderThickness="0"
                                CornerRadius="6"
                                Cursor="Hand"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"/>

						<Button Grid.Column="2"
                                Name="EditConfirmButton"
                                Content="만들기"
                                Focusable="False"
                                behaviors:SoundBehavior.ClickSound="OK"
                                Click="OnEditConfirm"
                                Padding="15,10"
                                Background="{DynamicResource Accent.Blue}"
                                Foreground="{DynamicResource Button.Foreground}"
                                BorderThickness="0"
                                CornerRadius="6"
                                Cursor="Hand"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"/>
					</Grid>
				</StackPanel>
			</Border>
		</Grid>

		<!-- Delete Confirmation Overlay -->
		<Grid Name="DeleteOverlay"
              IsVisible="False"
              Background="#CC000000"
              ZIndex="3100"
              PointerPressed="OnDeleteOverlayBackgroundClick">
			<Border Background="{DynamicResource Background.Card}"
                    CornerRadius="10"
                    Padding="20"
                    Margin="20,5,20,20"
                    MaxWidth="400"
                    VerticalAlignment="Top">
				<StackPanel Spacing="15">
					<TextBlock Text="플레이리스트 삭제"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{DynamicResource Text.Primary}"/>

					<TextBlock Name="DeleteMessageText"
                               Text="이 플레이리스트를 삭제하시겠습니까?"
                               FontSize="15"
                               Foreground="{DynamicResource Text.Primary}"
                               TextWrapping="Wrap"/>

					<TextBlock Text="※ 플레이리스트만 삭제되며, 게임은 삭제되지 않습니다."
                               FontSize="13"
                               Foreground="{DynamicResource Text.Muted}"
                               TextWrapping="Wrap"/>

					<Grid ColumnDefinitions="*,10,*">
						<Button Grid.Column="0"
                                Content="취소"
                                Focusable="False"
                                behaviors:SoundBehavior.ClickSound="Cancel"
                                Click="OnDeleteCancel"
                                Padding="15,10"
                                Background="{DynamicResource Background.Hover}"
                                Foreground="{DynamicResource Text.Primary}"
                                BorderThickness="0"
                                CornerRadius="6"
                                Cursor="Hand"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"/>

						<Button Grid.Column="2"
                                Content="삭제"
                                Focusable="False"
                                behaviors:SoundBehavior.ClickSound="OK"
                                Click="OnDeleteConfirm"
                                Padding="15,10"
                                Background="{DynamicResource Accent.Red}"
                                Foreground="{DynamicResource Button.Foreground}"
                                BorderThickness="0"
                                CornerRadius="6"
                                Cursor="Hand"
                                HorizontalAlignment="Stretch"
                                HorizontalContentAlignment="Center"/>
					</Grid>
				</StackPanel>
			</Border>
		</Grid>
	</Grid>

</UserControl>