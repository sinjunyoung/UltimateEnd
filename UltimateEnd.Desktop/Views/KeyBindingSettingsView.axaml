<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:UltimateEnd.Desktop.ViewModels"
             x:Class="UltimateEnd.Desktop.Views.KeyBindingSettingsView"
             x:DataType="vm:KeyBindingSettingsViewModel"
             x:Name="KeyBindingSettingsRoot"
             Focusable="True"
             Background="{DynamicResource Background.Primary}">

	<Grid RowDefinitions="Auto,Auto,*,Auto">

		<!-- 헤더 -->
		<Border Grid.Row="0"
                Background="{DynamicResource Background.Secondary}"
                Padding="20"
                BorderThickness="0,0,0,1"
                BorderBrush="{DynamicResource Background.Border}">
			<Grid ColumnDefinitions="Auto,*">
				<Border Grid.Column="0"
				        ClipToBounds="False"
				        PointerPressed="OnBackClick"
				        Cursor="Hand"
				        Margin="0,0,15,0">
					<PathIcon Classes="AnimatedIcon"
					          Data="{StaticResource Icon.Back}"
					          Width="{StaticResource IconSize.MenuIcon}"
					          Height="{StaticResource IconSize.MenuIcon}"
					          VerticalAlignment="Center"/>
				</Border>
				<StackPanel Grid.Column="1"
				            Margin="15,0,0,0">
					<TextBlock Text="키 설정"
					           FontSize="24"
					           FontWeight="Bold"
					           Foreground="{DynamicResource Text.Primary}"/>
					<TextBlock Text="버튼을 클릭한 후 할당할 키를 누르세요"
					           FontSize="14"
					           Foreground="{DynamicResource Text.Muted}"
					           Margin="0,5,0,0"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- 컨트롤러 타입 선택 -->
		<Border Grid.Row="1"
		        Background="{DynamicResource Background.Secondary}"
		        Padding="20,15"
		        BorderThickness="0,0,0,1"
		        BorderBrush="{DynamicResource Background.Border}">
			<StackPanel Orientation="Horizontal" Spacing="15">
				<TextBlock Text="컨트롤러 타입:"
				           FontSize="16"
				           VerticalAlignment="Center"
				           Foreground="{DynamicResource Text.Primary}"/>
				<ComboBox ItemsSource="{Binding ControllerTypes}"
				          SelectedItem="{Binding ControllerType}"
				          MinWidth="180"
				          FontSize="14"
				          Background="{DynamicResource Background.Primary}"
				          Foreground="{DynamicResource Text.Primary}"/>
				<TextBlock Text="※ Auto는 연결된 컨트롤러를 자동 감지합니다"
				           FontSize="12"
				           VerticalAlignment="Center"
				           Foreground="{DynamicResource Text.Muted}"/>
			</StackPanel>
		</Border>

		<!-- 게임패드 영역 -->
		<Border Grid.Row="2"
		        VerticalAlignment="Stretch"
		        HorizontalAlignment="Stretch"
		        ClipToBounds="False">
			<Viewbox Stretch="Uniform"
			         VerticalAlignment="Center"
			         HorizontalAlignment="Center"
			         Margin="0,30,0,0"
			         ClipToBounds="False">
				<Grid Width="1024" Height="768"
				      ClipToBounds="False">

					<!-- 배경 게임패드 이미지 -->
					<Image Source="avares://UltimateEnd/Assets/Images/gamepad.png"
					       Stretch="Uniform"
					       HorizontalAlignment="Center"
					       VerticalAlignment="Center"/>

					<!-- 투명 버튼들을 실제 게임패드 위치에 맞춰 배치 -->
					<Canvas Name="Canvas" Width="1024" Height="768" ClipToBounds="False">

						<!-- LB Button -->
						<Border Canvas.Left="213" Canvas.Top="106"
						        Name="BtnLB"
						        Width="130" Height="60"
						        Classes="GamepadButton"
						        CornerRadius="8"
						        Cursor="Hand"
						        PointerPressed="OnButtonClick"
						        Tag="LeftBumper">
							<StackPanel VerticalAlignment="Center">
								<TextBlock Text="LB" FontSize="18" FontWeight="Bold" HorizontalAlignment="Center" Classes="ButtonLabel"
								           Foreground="{DynamicResource Text.Primary}"/>
								<TextBlock Text="{Binding LeftBumper}" FontSize="12" Classes="KeyLabel"
								           HorizontalAlignment="Center"
								           Foreground="{DynamicResource Accent.Primary}"/>
							</StackPanel>
						</Border>

						<!-- RB Button -->
						<Border Canvas.Left="683" Canvas.Top="106"
						        Name="BtnRB"
						        Width="130" Height="60"
						        Classes="GamepadButton"
						        CornerRadius="8"
						        Cursor="Hand"
						        PointerPressed="OnButtonClick"
						        Tag="RightBumper">
							<StackPanel VerticalAlignment="Center">
								<TextBlock Text="RB"
								           FontSize="18"
								           FontWeight="Bold"
								           HorizontalAlignment="Center"
								           Classes="ButtonLabel"/>
								<TextBlock Text="{Binding RightBumper}"
								           FontSize="12"
								           HorizontalAlignment="Center"
								           Classes="KeyLabel"/>
							</StackPanel>
						</Border>

						<!-- D-Pad Down -->
						<Grid Canvas.Left="246" Canvas.Top="286"
						      Name="BtnDPadDown"
						      Width="55" Height="60"
						      Background="Transparent"
						      Cursor="Hand"
						      PointerPressed="OnButtonClick"
						      Tag="DPadDown">
							<Grid.Clip>
								<PathGeometry>
									<PathFigure StartPoint="27.5,0" IsClosed="True">
										<LineSegment Point="55,20"/>
										<LineSegment Point="55,60"/>
										<LineSegment Point="0,60"/>
										<LineSegment Point="0,20"/>
									</PathFigure>
								</PathGeometry>
							</Grid.Clip>

							<Path Fill="#15FFFFFF"
							      Stroke="#4A9EFF"
							      StrokeThickness="2"
							      Data="M 27.5,0 L 55,20 L 55,60 L 0,60 L 0,20 Z">
								<Path.Effect>
									<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
								</Path.Effect>
							</Path>

							<StackPanel VerticalAlignment="Center" Margin="0,10,0,0">
								<TextBlock Text="{Binding DPadDown}"
								           FontSize="11"
								           HorizontalAlignment="Center"
								           Foreground="#4A9EFF">
									<TextBlock.Effect>
										<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
									</TextBlock.Effect>
								</TextBlock>
							</StackPanel>
						</Grid>

						<!-- D-Pad Up -->
						<Grid Canvas.Left="246" Canvas.Top="212"
						      Name="BtnDPadUp"
						      Width="55" Height="60"
						      Background="Transparent"
						      Cursor="Hand"
						      PointerPressed="OnButtonClick"
						      Tag="DPadUp">
							<Grid.Clip>
								<PathGeometry>
									<PathFigure StartPoint="0,0" IsClosed="True">
										<LineSegment Point="55,0"/>
										<LineSegment Point="55,40"/>
										<LineSegment Point="27.5,60"/>
										<LineSegment Point="0,40"/>
									</PathFigure>
								</PathGeometry>
							</Grid.Clip>

							<Path Fill="#15FFFFFF"
							      Stroke="#4A9EFF"
							      StrokeThickness="2"
							      Data="M 0,0 L 55,0 L 55,40 L 27.5,60 L 0,40 Z">
								<Path.Effect>
									<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
								</Path.Effect>
							</Path>

							<StackPanel VerticalAlignment="Center" Margin="0,0,0,10">
								<TextBlock Text="{Binding DPadUp}"
								           FontSize="11"
								           HorizontalAlignment="Center"
								           Foreground="#4A9EFF">
									<TextBlock.Effect>
										<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
									</TextBlock.Effect>
								</TextBlock>
							</StackPanel>
						</Grid>

						<!-- D-Pad Right -->
						<Grid Canvas.Left="281" Canvas.Top="252"
						      Name="BtnDPadRight"
						      Width="65" Height="55"
						      Background="Transparent"
						      Cursor="Hand"
						      PointerPressed="OnButtonClick"
						      Tag="DPadRight">
							<Grid.Clip>
								<PathGeometry>
									<PathFigure StartPoint="20,0" IsClosed="True">
										<LineSegment Point="65,0"/>
										<LineSegment Point="65,55"/>
										<LineSegment Point="20,55"/>
										<LineSegment Point="0,27.5"/>
									</PathFigure>
								</PathGeometry>
							</Grid.Clip>

							<Path Fill="#15FFFFFF"
							      Stroke="#4A9EFF"
							      StrokeThickness="2"
							      Data="M 20,0 L 65,0 L 65,55 L 20,55 L 0,27.5 Z">
								<Path.Effect>
									<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
								</Path.Effect>
							</Path>

							<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10,0,0,0">
								<TextBlock Text="{Binding DPadRight}"
								           FontSize="11"
								           VerticalAlignment="Center"
								           Margin="5,0,0,0"
								           Foreground="#4A9EFF">
									<TextBlock.Effect>
										<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
									</TextBlock.Effect>
								</TextBlock>
							</StackPanel>
						</Grid>

						<!-- D-Pad Left -->
						<Grid Canvas.Left="201" Canvas.Top="251"
						      Name="BtnDPadLeft"
						      Width="65" Height="55"
						      Background="Transparent"
						      Cursor="Hand"
						      PointerPressed="OnButtonClick"
						      Tag="DPadLeft">
							<Grid.Clip>
								<PathGeometry>
									<PathFigure StartPoint="0,0" IsClosed="True">
										<LineSegment Point="45,0"/>
										<LineSegment Point="65,27.5"/>
										<LineSegment Point="45,55"/>
										<LineSegment Point="0,55"/>
									</PathFigure>
								</PathGeometry>
							</Grid.Clip>

							<Path Fill="#15FFFFFF"
							      Stroke="#4A9EFF"
							      StrokeThickness="2"
							      Data="M 0,0 L 45,0 L 65,27.5 L 45,55 L 0,55 Z">
								<Path.Effect>
									<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
								</Path.Effect>
							</Path>

							<StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,10,0">
								<TextBlock Text="{Binding DPadLeft}"
								           FontSize="11"
								           VerticalAlignment="Center"
								           Margin="5,0,0,0"
								           Foreground="#4A9EFF">
									<TextBlock.Effect>
										<DropShadowEffect Color="#4A9EFF" BlurRadius="8" OffsetX="0" OffsetY="0"/>
									</TextBlock.Effect>
								</TextBlock>
							</StackPanel>
						</Grid>

						<!-- Y Button (상단) -->
						<Border Canvas.Left="718" Canvas.Top="188"
						        Name="BtnY"
						        Width="70" Height="70"
						        Classes="GamepadButton"
						        CornerRadius="35"
						        Cursor="Hand"
						        PointerPressed="OnButtonClick"
						        Tag="ButtonY">
							<StackPanel VerticalAlignment="Center">
								<TextBlock Text="Y"
								           FontSize="22"
								           FontWeight="Bold"
								           HorizontalAlignment="Center"
								           Classes="ButtonLabel"/>
								<TextBlock Text="{Binding ButtonY}"
								           FontSize="11"
								           HorizontalAlignment="Center"
								           Classes="KeyLabel"/>
							</StackPanel>
						</Border>

						<!-- X Button (왼쪽) -->
						<Border Canvas.Left="664" Canvas.Top="242"
						        Name="BtnX"
						        Width="70" Height="70"
						        Classes="GamepadButton"
						        CornerRadius="35"
						        Cursor="Hand"
						        PointerPressed="OnButtonClick"
						        Tag="ButtonX">
							<StackPanel VerticalAlignment="Center">
								<TextBlock Text="X"
								           FontSize="22"
								           FontWeight="Bold"
								           HorizontalAlignment="Center"
								           Classes="ButtonLabel"/>
								<TextBlock Text="{Binding ButtonX}"
								           FontSize="11"
								           HorizontalAlignment="Center"
								           Classes="KeyLabel"/>
							</StackPanel>
						</Border>

						<!-- B Button (오른쪽) -->
						<Border Canvas.Left="771" Canvas.Top="241"
						        Name="BtnB"
						        Width="70" Height="70"
						        Classes="GamepadButton"
						        CornerRadius="35"
						        Cursor="Hand"
						        PointerPressed="OnButtonClick"
						        Tag="ButtonB">
							<StackPanel VerticalAlignment="Center">
								<TextBlock Text="B"
								           FontSize="22"
								           FontWeight="Bold"
								           HorizontalAlignment="Center"
								           Classes="ButtonLabel"/>
								<TextBlock Text="{Binding ButtonB}"
								           FontSize="11"
								           HorizontalAlignment="Center"
								           Classes="KeyLabel"/>
							</StackPanel>
						</Border>

						<!-- A Button (하단) -->
						<Border Canvas.Left="718" Canvas.Top="295"
						        Name="BtnA"
						        Width="70" Height="70"
						        Classes="GamepadButton"
						        CornerRadius="35"
						        Cursor="Hand"
						        PointerPressed="OnButtonClick"
						        Tag="ButtonA">
							<StackPanel VerticalAlignment="Center">
								<TextBlock Text="A"
								           FontSize="22"
								           FontWeight="Bold"
								           HorizontalAlignment="Center"
								           Classes="ButtonLabel"/>
								<TextBlock Text="{Binding ButtonA}"
								           FontSize="11"
								           HorizontalAlignment="Center"
								           Classes="KeyLabel"/>
							</StackPanel>
						</Border>

						<!-- 바인딩 중 표시 -->
						<Border Canvas.Left="362" Canvas.Top="550"
						        Name="BindingIndicator"
						        Width="300" Height="100"
						        Background="{DynamicResource Accent.Warning}"
						        CornerRadius="10"
						        IsVisible="{Binding IsBinding}">
							<StackPanel VerticalAlignment="Center">
								<TextBlock Text="{Binding BindingButtonName}"
								           FontSize="20" FontWeight="Bold"
								           HorizontalAlignment="Center"
								           Foreground="{DynamicResource Text.Primary}"/>
								<TextBlock Text="키를 눌러주세요..."
								           FontSize="16"
								           HorizontalAlignment="Center"
								           Foreground="{DynamicResource Text.Primary}"
								           Margin="0,10,0,0"/>
							</StackPanel>
						</Border>
					</Canvas>
				</Grid>
			</Viewbox>
		</Border>

		<!-- 하단 버튼들 -->
		<Border Grid.Row="3"
		        Background="{DynamicResource Background.Secondary}"
		        Padding="20"
		        BorderThickness="0,1,0,0"
		        BorderBrush="{DynamicResource Background.Border}">
			<StackPanel Orientation="Horizontal"
			            HorizontalAlignment="Center"
			            Spacing="15">
				<Button Content="기본값으로 리셋"
				        Name="ResetButton"
				        Command="{Binding ResetToDefaultCommand}"
				        Padding="20,12"
				        FontSize="16"
				        Background="{DynamicResource Accent.Danger}"
				        Foreground="{DynamicResource Text.Primary}"/>
				<Button Content="저장"
				        Command="{Binding SaveCommand}"
				        Padding="20,12"
				        FontSize="16"
				        Background="{DynamicResource Accent.Success}"
				        Foreground="{DynamicResource Text.Primary}"/>
			</StackPanel>
		</Border>
	</Grid>

</UserControl>